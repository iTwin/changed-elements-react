#!/bin/bash

# Get the name of the branch being pushed to
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# Check if the branch name matches the pattern
if [[ "$BRANCH_NAME" =~ ^release/changed-elements-react-v[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.[0-9a-zA-Z]+$ ]]; then
  # Extract version from CHANGELOG.md
  VERSION=$(grep -oP '^## \K[0-9]+\.[0-9]+\.[0-9]+' packages/changed-elements-react/CHANGELOG.md | head -1)

  # Extract version from package.json
  PACKAGE_VERSION=$(jq -r '.version' packages/changed-elements-react/package.json)

  # Compare versions
  if [ "$VERSION" != "$PACKAGE_VERSION" ]; then
    echo "Version mismatch: CHANGELOG.md version ($VERSION) does not match package.json version ($PACKAGE_VERSION) Please run npx changeset version. Then run again."
    exit 1
  fi
fi
